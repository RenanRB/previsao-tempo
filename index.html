<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>AdminLTE 2 | Dashboard</title>
        <!-- Tell the browser to be responsive to screen width -->
        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
        <!-- Bootstrap 3.3.6 -->
        <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
        <!-- Ionicons -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
        <!-- Theme style -->
        <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
        <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
        <!-- Morris chart -->
        <link rel="stylesheet" href="plugins/morris/morris.css">
        <!-- bootstrap wysihtml5 - text editor -->
        <link rel="stylesheet" href="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
        <!-- Select2 -->
        <link rel="stylesheet" href="plugins/select2/select2.min.css">
        <!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
        <link rel="stylesheet" href="plugins/forecastFont/font.css">
		<link rel="stylesheet" href="dist/css/estilo.css">
    </head>
    <body class="hold-transition skin-blue sidebar-mini">
        <div class="wrapper">
            <header class="main-header">
                <a href="#" class="logo">
                    <span class="logo-mini">
                        <b>A</b>
                        LT
                    
                    
                    </span>
                    <span class="logo-lg">
                        <b>Admin</b>
                        LTE
                    
                    
                    </span>
                </a>
                <nav class="navbar navbar-static-top" style="color:white;">
                    <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                        <span class="sr-only">Toggle navigation</span>
                    </a>
                </nav>
            </header>
            <aside class="main-sidebar">
                <section class="sidebar">
                    <div class="user-panel">
                        <div class="pull-left image">
                            <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                        </div>
                        <div class="pull-left info">
                            <p>Olá visitante!</p>
                        </div>
                    </div>
                    <ul class="sidebar-menu">
                        <li class="header">Previsão do tempo</li>
                        <li class="active treeview">
                            <a href="#">
                                <i class="fa fa-dashboard"></i>
                                <span>Previsão</span>
                            </a>
                        </li>
                    </ul>
                </section>
            </aside>
            <div class="content-wrapper">
                <!-- Main content -->
                <section class="content">
                    <div class="row">
                        <div class="col-md-12">
                        	<div class="box pull-left">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Filtro</h3>
                                    <div class="box-tools pull-right">
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                            <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                <form class="navbar-form" role="search">
                                    <div class="box-body col-md-3">
                                       
                                    	<select class="form-control select2" style="width:100%; float:left" id="estado"></select>
                                        
                                    </div>
                                    <div class="box-body col-md-3">
                                     
                                    	<select class="form-control select2" id="cidade" style="width:100%; float:left" onchange="previsao(this.value);"></select>
                                            
                                    </div>
									<div class="box-body col-md-3">
                                     
                                    	<button class="form-control" type="button" onclick="setLocalStorageData(estado.value, cidade.value);">Salvar como cidade favorita</button>
                                            
                                    </div>
                                </form>
                        	</div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Previsão do tempo para os próximos dias</h3>
                                    <div class="box-tools pull-right">
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                            <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="row">
                                        <div class="col-md-3 col-sm-6 col-xs-12">
                                            <div class="info-box bg-green box-temperatura">
                                                <span id="iconPrevisaoTempo0" class="font11"></span>
                                                <div class="info-box-content">
                                                    <span class="info-box-text" id="diaPrevisaoTempo0">Aguardando dados</span>
                                                    <span class="info-box-text normal-space" id="previsaoTempo0">Aguardando dados</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-sm-6 col-xs-12">
                                            <div class="info-box bg-green box-temperatura">
                                                <span id="iconPrevisaoTempo1" class="font11"></span>
                                                <div class="info-box-content">
                                                    <span class="info-box-text" id="diaPrevisaoTempo1">Aguardando dados</span>
                                                    <span class="info-box-text normal-space" id="previsaoTempo1">Aguardando dados</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-sm-6 col-xs-12">
                                            <div class="info-box bg-green box-temperatura">
                                                <span id="iconPrevisaoTempo2" class="font11"></span>
                                                <div class="info-box-content">
                                                    <span class="info-box-text" id="diaPrevisaoTempo2">Aguardando dados</span>
                                                    <span class="info-box-text normal-space" id="previsaoTempo2">Aguardando dados</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 col-sm-6 col-xs-12">
                                            <div class="info-box bg-green box-temperatura">
                                                <span id="iconPrevisaoTempo3" class="font11"></span>
                                                <div class="info-box-content">
                                                    <span class="info-box-text" id="diaPrevisaoTempo3">Aguardando dados</span>
                                                    <span class="info-box-text normal-space" id="previsaoTempo3">Aguardando dados</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="box">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Temperatura máxima e mínima</h3>
                                    <div class="box-tools pull-right">
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                            <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="row">
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <div class="info-box bg-green box-temperatura">
                                                <span class="icon-frosty font-size-temper"></span>
                                                <div class="info-box-content">
                                                    <span class="info-box-text" id="tempMinDia"></span>
                                                    <span class="info-box-text" id="tempMin"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <div class="info-box bg-green box-temperatura">
                                                <span class="icon-sun font-size-temper"></span>
                                                <div class="info-box-content">
                                                    <span class="info-box-text" id="tempMaxDia"></span>
                                                    <span class="info-box-text" id="tempMax"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="box">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Recomendação de Praia</h3>
                                    <div class="box-tools pull-right">
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                            <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="box-footer">
                                    <div class="row">
                                        <div class="col-md-12 col-sm-12 col-xs-12">
                                            <div class="info-box bg-green box-temperatura"  id="irPraia">
                                                <span class="icon-rainy icon-night font-size-temper"></span>
                                                <div class="info-box-content">
                                                    <span class="info-box-text normal-space">Aguardando dados</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="box">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Variação de Temperatura</h3>
                                    <div class="box-tools pull-right">
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse">
                                            <i class="fa fa-minus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="box-body chart-responsive">
                                    <div class="chart" id="revenue-chart" style="height: 106px;"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        <!-- ./wrapper -->
        <!-- jQuery 2.2.3 -->
        <script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
        <!-- jQuery UI 1.11.4 -->
        <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
        <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
        <script>
            $.widget.bridge('uibutton', $.ui.button);
        </script>
        <!-- Bootstrap 3.3.6 -->
        <script src="bootstrap/js/bootstrap.min.js"></script>
        <!-- Select2 -->
        <script src="plugins/select2/select2.full.min.js"></script>
        <!-- Morris.js charts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
        <script src="plugins/morris/morris.min.js"></script>
        <script src="plugins/sparkline/jquery.sparkline.min.js"></script>
        <!-- Bootstrap WYSIHTML5 -->
        <script src="plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
        <!-- Slimscroll -->
        <script src="plugins/slimScroll/jquery.slimscroll.min.js"></script>
        <!-- AdminLTE App -->
        <script src="dist/js/app.min.js"></script>
        <!-- AdminLTE for demo purposes -->
        <script src="dist/js/demo.js"></script>
        <script language="JavaScript" type="text/javascript" src="plugins/cidades/cidades-estados-1.4-utf8.js"></script>
        <script language="JavaScript" type="text/javascript" charset="utf-8">
			$(document).ready(function(){
				previsao($('#cidade').val());
			});

            new dgCidadesEstados({
				cidade: document.getElementById('cidade'),
				estado: document.getElementById('estado'),
				estadoDefault: localStorage.getItem("PREVISAO_ESTADO") || 'SC',
				cidadeDefault: localStorage.getItem("PREVISAO_CIDADE") || 'Blumenau'
			});
			
            $(function() {
                $(".select2").select2();
            });

            var climas = {
                storm: '<span class="basecloud"></span><span class="icon-thunder"></span>',
                snow: '<span class="basecloud"></span><span class="icon-snowy"></span>',
                hail: '<span class="basecloud"></span><span class="icon-hail"></span>',
                rain: '<span class="basecloud"></span><span class="icon-rainy"></span>',
                fog: '<span class="icon-mist"></span>',
                clear_day: '<span class="icon-sun"></span>',
                clear_night: '<span class="icon-moon"></span>',
                cloud: '<span class="icon-cloud"></span>',
                cloudly_day: '<span class="icon-cloud"></span><span class="icon-sunny"></span>',
                cloudly_night: '<span class="icon-cloud"></span><span class="icon-night"></span>',
                none_day : '<span class="icon-sun"></span>',
                none_night : '<span class="icon-moon"></span>'
            };


			function previsao(cidade) {
				var dadosGrafico = [];
                var tempMin = {temp: 50, dia: undefined};
                var tempMax = {temp: -50, dia: undefined};
                var ano;
                var tempo = undefined;
                var data;
                var praia = false;

				$.ajax({
					url: 'http://api.hgbrasil.com/weather/?format=json-cors&city_name='+cidade+'&key=8c1a92ae&locale=pt-br',
					dataType: 'json',
					success: function(dados) {
						ano = dados.results.date.split("/")[2];
					
						for (i = 0; i < 7; i++) {
							tempo = dados.results.forecast[i];
							if (i < 4) {
								$('#previsaoTempo'+i).html(tempo.description);
								$('#diaPrevisaoTempo'+i).html(i == 0 ? 'Hoje' : tempo.weekday);
                                $('#iconPrevisaoTempo'+i).html(climas[tempo.condition]);

							}
							
							if (tempo.min < tempMin.temp) {
								tempMin.temp = tempo.min;
								tempMin.dia = i == 0 ? 'Hoje' : tempo.weekday;
							}
							
							if (tempo.max > tempMax.temp) {
								tempMax.temp = tempo.max;
								tempMax.dia = i == 0 ? 'Hoje' : tempo.weekday;
							}
							
							data = dados.results.forecast[i].date.split('/');
							data = ano + '-' + data[1] + '-' + data[0];
							dadosGrafico.push({y: data, minima: parseInt(tempo.min), maxima: parseInt(tempo.max)});
							
						}
						
						$('#tempMinDia').html(tempMin.dia);
						$('#tempMin').html(tempMin.temp + 'º');

						$('#tempMaxDia').html(tempMax.dia);
						$('#tempMax').html(tempMax.temp + 'º');

						$.ajax({
							url: 'http://api.hgbrasil.com/weather/?format=json-cors&city_name=Balneário%20Camboriú&key=8c1a92ae&locale=pt-br',
							dataType: 'json',
							success: function(dadosPraia) {
                                var tempoPraia = dadosPraia.results.forecast[i];

								for (i = 0; i < 7; i++) {
									if (tempoPraia.weekday == 'Sab' || tempoPraia.weekday == 'Dom' && tempoPraia.max >= 25 && tempoPraia.condition == 'clear_day')
										praia = true;
								}
								
								if (praia) {
									$('#irPraia').html('<span class="icon-sun font-size-temper"></span><div class="info-box-content"><span class="info-box-text normal-space">Ótimo fim de semana para ir a praia!</span></div>');
								} else {
									$('#irPraia').html('<span id="iconPrevisaoTempo2" class="font11"><span class="basecloud"></span><span class="icon-thunder"></span></span><div class="info-box-content"><span class="info-box-text normal-space">Não é um bom fim de semana para ir a praia!</span></div>');
								}
							}
						});
						
						Morris.Line({
						element: 'revenue-chart',
						data: dadosGrafico,
						xkey: 'y',
						ykeys: ['maxima', 'minima'],
						labels: ['maxima', 'minima'],
						lineColors: ['#ca4747', '#a0d0e0'],
						hideHover: 'auto'
					});
						
					}
				});
			}

            function supportsHTML5Storage() {
                try {
                    return 'localStorage' in window && window['localStorage'] !== null;
                } catch (e) {
                    return false;
                }
            }

            function setLocalStorageData(estado, cidade) {
                if (!supportsHTML5Storage()) {
                    return false;
                }
                localStorage.setItem("PREVISAO_ESTADO", estado);
                localStorage.setItem("PREVISAO_CIDADE", cidade);
            }
        
        </script>
    </body>
</html>
